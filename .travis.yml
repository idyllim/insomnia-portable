os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.10
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: hLFHp2kd6nZGbBenvX+jH0izIYFk/ATx6AASHQ8fdhQ7gCR9E5catThuzZY0B3EGPWmkZKMo55G766YoSwQ+8g1V0HaerkuWg6KVX3JAMBto3Ukrlb7Qy0doNQMNiTzeijstCXlskppZ27TkyrKnHDP3hsQt7GZz4KYLqiW3pGsPMILZ/EqEIYPJU9YI2p5PWqaBCIucJk5mrVZ8Ys1Xkud7vtDRN1yqgVDEx8uHKMgrsfdFNBHN2D2qEJed/Lfa89jyofQfOaiNc/slJfs96JuPiJID7rjrWTS+GQJ4uVs5iqIOICcCDRvx/lG49MTsHsSfh6AaP1GSPxQQQkXalgeQNDsfSJo/OQBodSRqzQRx4cQSEsyQ3YW+l7rS+VTjOE3OHfysfdUyrehzLa7QMxnSvbo2PO3HD4cm70zC+oD2gdhrwp50tVBTFXt8XUd4iCbg8Bh4f1dRJo3p1MBXPHr39vd33k964rR4LKTdGRfObQ9V+jspylJiK2EOIHZYGZCh+vIpU5zERR2oBfy7Lrk/P4wbXtd7EYtzZMwPpE7NbqBkwdPDuUDIGfh6e7XOrappgyxQpKDcsDKDXhjMorLkZ7U/XPRUqVQAH5IxbH/OGu2B2mod0CPBJnM80jyWU8J78OlnMSD9vGJlpD2Lmm1TMu0xSTPbD91eq6t5ZQA=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
